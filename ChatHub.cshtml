@{
    Layout = "~/_SiteLayout.cshtml";
    Page.Title = "ChatHub";
}
<script src="~/JS/bootbox.min.js"></script>
<script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
<script src="signalR/hubs"></script>
<style>
    .c-list {
        padding: 0px;
        min-height: 44px;
    }

    .title {
        display: inline-block;
        font-size: 1.7em;
        font-weight: bold;
        padding: 5px 15px;
    }

    ul.c-controls {
        list-style: none;
        margin: 0px;
        min-height: 44px;
    }

        ul.c-controls li {
            margin-top: 8px;
            float: left;
        }

            ul.c-controls li a {
                font-size: 1.7em;
                padding: 11px 10px 6px;
            }

                ul.c-controls li a i {
                    min-width: 24px;
                    text-align: center;
                }

                ul.c-controls li a:hover {
                    background-color: rgba(51, 51, 51, 0.2);
                }

    .c-toggle {
        font-size: 1.7em;
    }

    .name {
        font-size: 1.7em;
        font-weight: 700;
    }

    .c-info {
        padding: 5px 10px;
        font-size: 1.25em;
    }
</style>
<script>
    var chat = $.connection.chatHub; //chatHub小寫
    var name = null;
    //初始
    $(function () {
        name = prompt("Please input your Pseudonym", "TeacherA");
        /*        bootbox.prompt({
                    title: "Hi " + name + ", before you use this tool to communication, please check the requirements listed below.",
                    inputType: 'checkbox',
                    inputOptions: [
                        {
                            text: 'Do not leak any privacy of any child.',
                            value: '1'
                        },
                        {
                            text: 'Show you respect to every user in the channel.',
                            value: '2'
                        }
                    ],
                    callback: function (result) {
                        console.log(result);
                    }
                });*/
    });

    //signalR啟動完成後，要執行的動作
    $.connection.hub.start().done(function () {

        //通知Server，有新使用者連進來
        chat.server.userConnected(name);

        //按傳送鈕
        $('#btnSend').click(function () {
            send();
        });
        //按Enter鍵
        $('#txtMsg').keydown(function (e) {
            if (e.which == 13) {
                send();
            }
        });

        //選取某一個使用者
        //★用 $("#lstUser li").click()會抓不到
        //★jQuery1.7以前建議使用$("#lstUser li").live("click",fn)
        //★jQuery1.7以後建議使用$(document).on("click", "#lstUser li",fn)
        $(document).on("click",
            "#lstUser li",
            function () {
                var name = $(this).html();
                var id = $(this).attr('id');

                $('#lblTalkToWho').html(name);
                $('#lblTalkToWhoId').html(id);
            });
    });

    //顯示訊息
    chat.client.show = function (message) {
        $('#chatRoom').append('<li>' + message + '</li>');
    };

    //顯示user清單
    chat.client.getList = function (users) {
        var li = "<li id=all>Public Channel</li>";
        $.each(users,
            function (i, user) {
                li += '<li id=' + user.id + ' >' + user.name + '</li>'
            });
        $('#lstUser').html(li);
    };

    //使用者離開
    chat.client.removeList = function (id) {
        $('#' + id).remove();
    };

    function checkkeywords(sentence) {
        var flag = false;
        var keywords = ['VIC', 'vic', 'NSW', 'nsw', 'TAS', 'tas', 'ACT', 'act', 'SA', 'sa', 'WA', 'wa'];
        for (var i = 0; i < keywords.length; i++) {
            var check = sentence.search(keywords[i]);
            if (check >= 0) {
                flag = true;
            }
        }
        return flag;
    }
    console.log(checkkeywords("Hello, this is"));

    //傳送聊天內容至Server
    function send() {
        var id = $('#lblTalkToWhoId').text();
        var message = $('#txtMsg').val();
        if (id == "all") {
            if (checkkeywords(message.toLowerCase())) {
                bootbox.alert("dont input personal address");
            }
            else {
                chat.server.send($('#txtMsg').val());
            }
        } else {
            chat.server.sendOne(id, $('#txtMsg').val());
        }
        $('#txtMsg').val('');
    }

</script>

<div class="container">
    <div class="row clearfix">
        <br>
        <div class="row">
            <div class="col-xs-6 col-sm-offset-1 col-sm-5">
                <div class="panel panel-warning">
                    <div class="panel-heading">Chat Room</div>
                    <div class="panel-body" style="height: 350px; word-break: break-all; overflow-y: scroll;">
                        <ul id="chatRoom"></ul>
                    </div>
                </div>
                <div class="container">
                        Send To:
                        <label id="lblTalkToWho">Public Channel</label>
                        <label id="lblTalkToWhoId" hidden>all</label>
                        <input id="txtMsg" type="text" />
                        <input type="button" id="btnSend" value="Send" class="btn btn-warning"/>
                </div>
            </div>
            <div class="col-xs-6 col-sm-offset-0 col-sm-3">
                <div class="panel panel-warning">
                    <div class="panel-heading">Contact List</div>
                    <div class="panel-body" style="height: 410px; word-break: break-all; overflow-y: scroll;">
                        <ul class="list-group" id="contact-list">
                            <li class="list-group-item">
                                <ul id="lstUser"></ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <br />
@*        <div class="row">
            <div class="col-xs-6 col-sm-offset-1 col-sm-5">
                Send To:
                <label id="lblTalkToWho">Public Channel</label>
                <label id="lblTalkToWhoId" hidden>all</label>
                <input id="txtMsg" type="text" />
                <input id="btnSend" type="button" value="Send" class="btn-warning"/>
            </div>
        </div>*@
    </div>
</div>